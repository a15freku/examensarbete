<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>HTML5 Canvas</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script type="text/javascript" src="../Data/data.js"></script>
  <!-- <script type="text/javascript" src="../Data/dataFunctions.js"></script> -->

  <style >
    canvas {
    width: 1250px;
    height: 300px;
    background-color: white;
    border: solid;
    border-color: black;
    }
  </style>

</head>

<body>
  <canvas width="600" height="300" id="canvas"></canvas>
  <script>
    // Retrive JSON object from data.js
    var data = stockObj.data;

    var orgDataLen = data.length;

    // Creates more data from existing data
    function applyOffset(input) {
      // Set how many graphs should be used
      for(var i = 0; i < 10000; i++) {
        // Create more data
        var src = input[i%orgDataLen];
        var o = new Object();
        o.name = src.name+i;
        o.value = [];
        input[orgDataLen+i] = o;
        // Apply Offset
        for(var j = 0; j < 251; j++) {

          var max = 1.01;
          var min = 0.99;
          var r = Math.random() * (max - min) + min;
          o.value[j] = src.value[j] * r;
        }
      }
    // Return offsetData
    return input;
    }

    // New Normalize data function
    function normalize(input){
      for(var i = 0; i < input.length; i++) {

        var length = input[i].value.length;
        var min = input[i].value[0];
        var max = min;

        for(var j = 1; j < length; j++) {

          var val = input[i].value[j];
          min = Math.min(min, val);
          max = Math.max(max, val);

        }
        var range = max - min;

        var normArray = [];
        for(var k = 0; k < length; k++) {

          normArray.push((input[i].value[k] - min) / range);
          
        }
        input[i].value = normArray;
      }

      return input;
    }

    // Normalized data
    data = applyOffset(data);
    data = normalize(data);

    // Loop data
    function loopData(data, opacity) {
      //var lengthBetweenPoints = data.length / (data.length / 5);
      var dataLength = data.length;
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      for(var j = 0; j < dataLength; j++){
        ctx.beginPath();
        ctx.strokeStyle = "green";
        ctx.moveTo(0, data[j].value[0] * 300);
        for(var i = 1; i < 251; i++) {
          ctx.globalAlpha = opacity;
          ctx.lineTo(i * 5, data[j].value[i] * 300);
        }
        ctx.stroke();
        ctx.closePath();
      }

    }

    var canvas = document.getElementById('canvas');
    ctx = canvas.getContext('2d');
    canvas.width = 1250;
    ctx.translate(0, canvas.height);
    ctx.scale(1, -1);
    /*
    // Lines for x and y-axis
    ctx.beginPath();
    ctx.moveTo(0, 0);
    ctx.lineTo(canvas.width, 0);
    ctx.moveTo(0, 0);
    ctx.lineTo(0, 300);
    ctx.lineTo(canvas.width, 300);
    ctx.lineTo(canvas.width, -300);
    ctx.stroke();
    ctx.closePath();
    */
    
    // Write graphs in diagram
    function opacitySlider() {
      for(var k = 10; k >= 0; k--) {
        loopData(data, k/10);
      }
    }

    function testFunction(tests) {
      for(var i = 1; i <= tests; i++) {
        var startDate = new Date();
        opacitySlider();
        var endDate = new Date();
        var milliseconds = endDate.getTime() - startDate.getTime();
        console.log("Test " + i + " ms: " + milliseconds);
      }
    }

    function showGraph() {
      loopData(data,1);
    }
    showGraph();
    
  </script>
</body>

</html>